{% extends "base.html" %}
{% block page_content %}
<style>
    .search-form .form-control:focus {
        border-color: #198754;
        box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
    }
</style>

<br>
<div class="container">
        <h5 class="d-flex justify-content-center">
            <b>Заявки ожидающие исполнения:</b>
        </h5>
        <div class="row d-flex justify-content-center py-3 mb-4 border-bottom border-success">
                {% for application in applications %}
                <div class="col-md-3 mb-3 d-flex align-items-stretch">
                    <div class="card h-100 border border-success">
                        <div class="card-body">
                            <h5 class="card-title"><b>{{ application }} от {{ application.created_on|date:"d.m.Y" }}</b></h5>
                            <p class="card-text">{{ application.declarant }}</p>
                            <p class="card-text"><b>{{ application.num_of_mach }} шт.</b></p>
                            <p class="card-text">Статус заявки: {{ application.status }}</p>
                            <a href="{% url 'application_distribution' application.pk %}"
                               class="stretched-link">
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
        </div>
    <h3 class="d-flex justify-content-center">
        <b>Журнал распределения работ по техническому освидетельствованию игровых автоматов</b>
    </h3>
    <form class="search-form d-flex" role="search">
    <table class="table table-hover table-striped table-bordered border-2 border-success text-center">
      <thead class="table table-success table-bordered border-success align-middle">
        <tr>
          <th scope="col" colspan="3">Заявка</th>
          <th scope="col">Наименование заявителя</th>
          <th scope="col">Модели ИА</th>
          <th scope="col" style="width: 70px;">Кол-во ИА</th>
          <th scope="col" style="width: 100px;">Место проведения ТО</th>
          <th scope="col" style="width: 100px;">Акт ТО</th>
          <th scope="col" style="width: 80px;">Исп-ль</th>
          <th scope="col">Примечания</th>
          <th scope="col" style="width: 50px;">Изм.</th>
        </tr>
      </thead>
      <tbody>
        <tr>
            <td style="width: 80px;">
                <input type="search" name="app" class="form-control me-2" value="{{ app_get|default:'' }}" aria-label="Search">
            </td>
            <td>
                <input type="date" name="date_start" class="form-control me-2 datepicker" value="{{ date_get_start|default:'' }}" aria-label="Search">
                <input type="date" name="date_end" class="form-control me-2 datepicker" value="{{ date_get_end|default:'' }}" aria-label="Search">
            </td>
            <td>  </td>
            <td>
                    <input type="search" name="declarant" class="form-control me-2" value="{{ declarant_get|default:'' }}" aria-label="Search">
            </td>
            <td>  </td>
            <td>
                Всего:
                {{ mach_total }}
            </td>
            <td>
                    <input type="search" name="place" class="form-control me-2" value="{{ place_get|default:'' }}" aria-label="Search">
            </td>
            <td>
                <input type="search" name="act" class="form-control me-2" value="{{ act_get|default:'' }}" aria-label="Search">
            </td>
            <td>
                <input type="search" name="user" class="form-control me-2" value="{{ user_get|default:'' }}" aria-label="Search">
            </td>
            <td>  </td>
            <td>
                <button type="submit" class="btn btn-outline-success" style="display: none;">
                    <i class="bi bi-search"></i>
                </button>
            </td>
        </tr>
      {% for distribution in distributions %}
        <tr>
          <td>{{ distribution }}</td>
          <td>{{ distribution.application.created_on|date:"d.m.Y" }}</td>
          <td>
              {% if distribution.application.pdf %}
                <a href="{{ distribution.application.pdf.url }}" class="text text-success" target="_blank">Просмотр</a>
              {% else %}
                <a class="text text-danger">Пусто</a>
              {% endif %}
          </td>
          <td class="text-start ps-4">{{ distribution.application.declarant }}</td>
          <td>{{ distribution.short_slot_name }}</td>
          <td>{{ distribution.application.num_of_mach }}</td>
          <td>
              {% if distribution.place %}
                {{ distribution.place }}
              {% else %}
                <span class="text-danger">---</span>
              {% endif %}
          </td>
          <td>{{ distribution.act }}</td>
          <td>{{ distribution.user }}</td>
          <td>{{ distribution.notice }}</td>
          <td><a href="{% url 'distribution_change' distribution.pk  %}" class="btn btn-success" style="padding: 2px 6px; font-size: 12px;">Изм.</a>
          </td>

        </tr>
      {% endfor %}
      </tbody>
    </table>
    </form>
</div>

{% endblock %}